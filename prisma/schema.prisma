generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int           @id @default(autoincrement())
  username           String
  email              String
  password           String
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  tasks              Task[]        @relation("UserTasks")
  createdProjects    Project[]     @relation("CreatedProjects")
  userProjects       UserProject[]
  assignments        Assignment[]  @relation("UserAssignments")
  createdAssignments Assignment[]  @relation("AssignedTo")
}

model Task {
  id          Int          @id @default(autoincrement())
  content     String
  status      String
  createdById Int
  createdBy   User         @relation("UserTasks", fields: [createdById], references: [id])
  assignments Assignment[] @relation("TaskAssignments")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Project {
  id           Int           @id @default(autoincrement())
  title        String
  description  String
  adminId      Int
  admin        User          @relation("CreatedProjects", fields: [adminId], references: [id])
  userProjects UserProject[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserProject {
  userId    Int
  projectId Int

  user    User    @relation(fields: [userId], references: [id])
  project Project @relation(fields: [projectId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([userId, projectId])
  @@map("user_projects")
}

model Assignment {
  id           Int  @id @default(autoincrement())
  assignedById Int
  assignedBy   User @relation("UserAssignments", fields: [assignedById], references: [id])
  taskId       Int
  task         Task @relation("TaskAssignments", fields: [taskId], references: [id])
  assignedToId Int
  assignedTo   User @relation("AssignedTo", fields: [assignedToId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
